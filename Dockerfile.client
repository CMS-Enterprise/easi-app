FROM trussworks/circleci-docker-primary:tf12-5ee2cb35bc081dbc91da46afc3904ef0e1c111fb AS builder
USER root

WORKDIR /app
COPY . .

ARG REACT_APP_API_ADDRESS
ARG REACT_APP_OKTA_CLIENT_ID
ARG REACT_APP_OKTA_DOMAIN
ARG REACT_APP_OKTA_ISSUER
ARG REACT_APP_OKTA_REDIRECT_URI
ARG REACT_APP_OKTA_SERVER_ID

RUN yarn install
RUN yarn run build

FROM trussworks/circleci-docker-primary:tf12-5ee2cb35bc081dbc91da46afc3904ef0e1c111fb
USER root

RUN yarn global add serve
WORKDIR /app
COPY --from=builder /app/build .
