# CEDAR Intake API Client

This folder contains code for submitting data to the CEDAR Intake API for eventual storage in Alfabet. 
The Intake API is designed to take a JSON string in its `Body` field, as well as a schema identifier in its `Schema` field.

## Schemas

The CEDAR team needs a schema of the data we send them in order to decode it for storage in Alfabet. We have a script in [`cmd/gen_intake_schema/main.go`](/cmd/gen_intake_schema/main.go), which uses the [jsonschema package](https://pkg.go.dev/github.com/alecthomas/jsonschema) to generate [JSON schema](https://json-schema.org/) documents describing the possible payloads. This script gets called as a pre-commit hook if any relevant file is changed, in order to make sure the schemas are up-to-date.

## Package Structure

- `pkg/cedar/intake/gen/`: This is auto-generated code from the Intake API's Swagger file. Of note is the [`IntakeInput`](gen/models/intake_input.go) type, which will be used by the API client to submit data.
- `pkg/cedar/intake/models/`: These struct definitions are the source of truth for generating the schema documents.
- `pkg/cedar/intake/translation/`: Each file in this package corresponds to a file in `pkg/cedar/intake/models`, and contains code for the following:
    1. Translating a domain model (defined under `pkg/models`) into the type defined in `pkg/cedar/intake/models`.
    1. Marshaling that struct into a JSON string, then embedding it in an `IntakeInput` struct, tagged with the appropriate schema version.
- [`pkg/cedar/intake/client.go`](client.go): A wrapper around the autogenerated client code from the Intake API Swagger, which has public methods for publishing different types of objects to the Intake API.
